/*! For license information please see 1627cac0.8430b880.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3258],{1664:e=>{var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(o){return!1}}()?Object.assign:function(e,o){for(var i,s,a=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),c=1;c<arguments.length;c++){for(var l in i=Object(arguments[c]))n.call(i,l)&&(a[l]=i[l]);if(t){s=t(i);for(var u=0;u<s.length;u++)r.call(i,s[u])&&(a[s[u]]=i[s[u]])}}return a}},2192:(e,t,n)=>{n(1664);var r=n(3696),o=60103;if(t.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var i=Symbol.for;o=i("react.element"),t.Fragment=i("react.fragment")}var s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a=Object.prototype.hasOwnProperty,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,i={},l=null,u=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,r)&&!c.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:o,type:e,key:l,ref:u,props:i,_owner:s.current}}t.jsx=l,t.jsxs=l},4403:(e,t,n)=>{var r=n(1664),o=60103,i=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var s=60109,a=60110,c=60112;t.Suspense=60113;var l=60115,u=60116;if("function"==typeof Symbol&&Symbol.for){var f=Symbol.for;o=f("react.element"),i=f("react.portal"),t.Fragment=f("react.fragment"),t.StrictMode=f("react.strict_mode"),t.Profiler=f("react.profiler"),s=f("react.provider"),a=f("react.context"),c=f("react.forward_ref"),t.Suspense=f("react.suspense"),l=f("react.memo"),u=f("react.lazy")}var d="function"==typeof Symbol&&Symbol.iterator;function p(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y={};function m(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||h}function v(){}function x(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||h}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(p(85));this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=m.prototype;var g=x.prototype=new v;g.constructor=x,r(g,m.prototype),g.isPureReactComponent=!0;var w={current:null},j=Object.prototype.hasOwnProperty,b={key:!0,ref:!0,__self:!0,__source:!0};function _(e,t,n){var r,i={},s=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)j.call(t,r)&&!b.hasOwnProperty(r)&&(i[r]=t[r]);var c=arguments.length-2;if(1===c)i.children=n;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}if(e&&e.defaultProps)for(r in c=e.defaultProps)void 0===i[r]&&(i[r]=c[r]);return{$$typeof:o,type:e,key:s,ref:a,props:i,_owner:w.current}}function k(e){return"object"==typeof e&&null!==e&&e.$$typeof===o}var A=/\/+/g;function E(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function O(e,t,n,r,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c=!1;if(null===e)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case o:case i:c=!0}}if(c)return s=s(c=e),e=""===r?"."+E(c,0):r,Array.isArray(s)?(n="",null!=e&&(n=e.replace(A,"$&/")+"/"),O(s,t,n,"",(function(e){return e}))):null!=s&&(k(s)&&(s=function(e,t){return{$$typeof:o,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,n+(!s.key||c&&c.key===s.key?"":(""+s.key).replace(A,"$&/")+"/")+e)),t.push(s)),1;if(c=0,r=""===r?".":r+":",Array.isArray(e))for(var l=0;l<e.length;l++){var u=r+E(a=e[l],l);c+=O(a,t,n,u,s)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=d&&e[d]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),l=0;!(a=e.next()).done;)c+=O(a=a.value,t,n,u=r+E(a,l++),s);else if("object"===a)throw t=""+e,Error(p(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return c}function P(e,t,n){if(null==e)return e;var r=[],o=0;return O(e,r,"","",(function(e){return t.call(n,e,o++)})),r}function S(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var I={current:null};function C(){var e=I.current;if(null===e)throw Error(p(321));return e}var R={ReactCurrentDispatcher:I,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:w,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:P,forEach:function(e,t,n){P(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!k(e))throw Error(p(143));return e}},t.Component=m,t.PureComponent=x,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,t.cloneElement=function(e,t,n){if(null==e)throw Error(p(267,e));var i=r({},e.props),s=e.key,a=e.ref,c=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,c=w.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(u in t)j.call(t,u)&&!b.hasOwnProperty(u)&&(i[u]=void 0===t[u]&&void 0!==l?l[u]:t[u])}var u=arguments.length-2;if(1===u)i.children=n;else if(1<u){l=Array(u);for(var f=0;f<u;f++)l[f]=arguments[f+2];i.children=l}return{$$typeof:o,type:e.type,key:s,ref:a,props:i,_owner:c}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:a,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=_,t.createFactory=function(e){var t=_.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=k,t.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:S}},t.memo=function(e,t){return{$$typeof:l,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return C().useCallback(e,t)},t.useContext=function(e,t){return C().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return C().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return C().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return C().useLayoutEffect(e,t)},t.useMemo=function(e,t){return C().useMemo(e,t)},t.useReducer=function(e,t,n){return C().useReducer(e,t,n)},t.useRef=function(e){return C().useRef(e)},t.useState=function(e){return C().useState(e)},t.version="17.0.2"},3696:(e,t,n)=>{e.exports=n(4403)},2540:(e,t,n)=>{e.exports=n(2192)},7185:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>f,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var r=n(2540),o=n(8453);const i={},s="Expanding Ext API",a={id:"development/extapi",title:"Expanding Ext API",description:"Overview",source:"@site/../docs/development/extapi.md",sourceDirName:"development",slug:"/development/extapi",permalink:"/launcher/docs/development/extapi",draft:!1,unlisted:!1,editUrl:"https://github.com/FlashpointProject/launcher/edit/develop/website/../docs/development/extapi.md",tags:[],version:"current",lastUpdatedAt:171249107e4,frontMatter:{},sidebar:"docs",previous:{title:"Language Support",permalink:"/launcher/docs/development/lang"},next:{title:"Overview",permalink:"/launcher/docs/extensions/overview"}},c={},l=[{value:"Overview",id:"overview",level:2},{value:"Adding a new function",id:"adding-a-new-function",level:2}];function u(e){const t={admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h1,{id:"expanding-ext-api",children:"Expanding Ext API"}),"\n",(0,r.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(t.p,{children:"Launcher extensions allow people to add new functionality to the Launcher without requiring to build their own versions from the source. During Launcher development it can be good to expose functionality which would be useful to extensions, which is where the extensions API comes in."}),"\n",(0,r.jsxs)(t.p,{children:["Flashpoint Launher's extensions API is defined by the shape of ",(0,r.jsx)(t.code,{children:"typings/flashpoint-launcher.d.ts"}),". Adding functionality is fairly easy and doesn't require intimate knowledge of how the API is served, however I've outlined how the API is served to the extension because it can sometimes help."]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Launcher registers a Node Module Interceptor for ",(0,r.jsx)(t.code,{children:"flashpoint-launcher"})," (See ",(0,r.jsx)(t.code,{children:"src/back/extensions/NodeInterceptor.ts"})," for details)"]}),"\n",(0,r.jsxs)(t.li,{children:["Launcher runs the extensions ",(0,r.jsx)(t.code,{children:"activate"})," function"]}),"\n",(0,r.jsxs)(t.li,{children:["Extension tries to import ",(0,r.jsx)(t.code,{children:"flashpoint-launcher"}),", the Interceptor gets control of the request instead."]}),"\n",(0,r.jsxs)(t.li,{children:["Interceptor passes the extensions details to ",(0,r.jsx)(t.code,{children:"createApiFactory"})," in ",(0,r.jsx)(t.code,{children:"src/back/ApiImplementation.ts"}),", which returns an object in the shape of the extensions API."]}),"\n",(0,r.jsx)(t.li,{children:"Extension can now use this API object it was given"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["Since the API is created during import for each module, the functions you implement are effectively sandboxed and you may wish to take advantage of that. Objects like the ",(0,r.jsx)(t.code,{children:"state"})," variable passed to ",(0,r.jsx)(t.code,{children:"createApiFactory"})," is still shared between API implementation."]}),"\n",(0,r.jsx)(t.p,{children:"This approach was built from VSCode's own extensions system, whilst not identical some of the principles remain the same in both."}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsx)(t.p,{children:"When adding new functions and constants to the API, you must define all the typings in the API typings file itself, you cannot import from other files or modules. The only imports that work are from node APIs."})}),"\n",(0,r.jsx)(t.h2,{id:"adding-a-new-function",children:"Adding a new function"}),"\n",(0,r.jsx)(t.p,{children:"To add a new function, you need to do 2 things:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Add the definition to the API typings in ",(0,r.jsx)(t.code,{children:"typings/flashpoint-launcher.d.ts"})]}),"\n",(0,r.jsxs)(t.li,{children:["Add the implementation to ",(0,r.jsx)(t.code,{children:"createApiFactory"})," in ",(0,r.jsx)(t.code,{children:"src/back/ApiImplementation.ts"})]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"For example, if we want to add a function that shows an alert to the user, first we add the definition:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",metastring:'title="typings/flashpoint-launcher.d.ts"',children:"declare module 'flashpoint-launcher' {\n  // ...\n  namespace dialogs {\n    // ...\n    function showAlert(message: string): void;\n  }\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Next, we find the ",(0,r.jsx)(t.code,{children:"dialogs"})," namespace object in ",(0,r.jsx)(t.code,{children:"createApiFactory"})," and add our implementation"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",metastring:'title="src/back/ApiImplementation.ts"',children:"export function createApiFactory(extId: string, extManifest: IExtensionManifest, addExtLog: (log: ILogEntry) => void, version: string, state: BackState, extPath?: string): typeof flashpoint {\n  // ...\n  const extDialogs: typeof flashpoint.dialogs = {\n    // ...\n    showAlert: (message) => state.socketServer.broadcast(BackOut.OPEN_ALERT, message),\n  }\n}\n"})}),"\n",(0,r.jsx)(t.p,{children:"Since we have access to some extension information, we can also choose to show which extension sent the alert if we want to:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:"showAlert: (message) => state.socketServer.broadcast(BackOut.OPEN_ALERT, `${extManifest.displayName} - ${message}`),\n"})})]})}function f(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>a});var r=n(6540);const o={},i=r.createContext(o);function s(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);